{"code":"(()=>{\n\"use strict\";var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,\"default\",{value:mod,enumerable:true}):target,mod));var import_child_process=require(\"child_process\");var import_fs=__toESM(require(\"fs\"));var import_path=__toESM(require(\"path\"));var import_paths=require(\"./paths\");function generateValidPackageName(name){name=name.trim().toLowerCase();name=name.replace(/@/g,\"\").replace(/\\//g,\"_\").replace(/[^a-z0-9-_]/g,\"\").replace(/^[_\\.]/,\"\").replace(/[_\\.]$/,\"\");if(name===\"\"){throw new Error(\"Invalid package name: Name cannot be empty after cleanup.\")}return name}__name(generateValidPackageName,\"generateValidPackageName\");const generateExtensionsImportFile=__name((entries=[])=>{const clientImports=[];const serverImports=[];const clientExports=[`export const registerClients = () => ([`];const serverExports=[`export const registerServers = () => ({`];for(const index in entries){const entry=entries[index];console.log(\"====\",entry);if(entry.clientPath){clientImports.push(`const client${index} = import(\"${entry.clientPath}\").then((m) => m.registerClient());`);clientExports.push(\"  {\");clientExports.push(`    extensionName: \"${entry.name}\", `);clientExports.push(`    routerScope: \"${entry.id}\",`);clientExports.push(`    label: \"${entry.label}\",`);clientExports.push(`    App: client0.then((m) => ({ default: m.App })),`);clientExports.push(`    Logo: client0.then((m) => ({ default: m.Logo })),`);clientExports.push(\"  },\")}if(entry.serverPath){serverImports.push(`import * as server${index} from \"${entry.serverPath}\";`);serverExports.push(`  \"${entry.id}\": server${index}.registerRouter().appRouter,`)}}clientExports.push(`])`);serverExports.push(`})`);const clientFileContent=[...clientImports,\"\",...clientExports];const serverFileContent=[...serverImports,\"\",...serverExports];import_fs.default.mkdirSync(import_path.default.dirname(import_paths.clientImportsFile),{recursive:true});import_fs.default.writeFileSync(import_paths.clientImportsFile,clientFileContent.join(\"\\n\"));import_fs.default.mkdirSync(import_path.default.dirname(import_paths.serverImportsFile),{recursive:true});import_fs.default.writeFileSync(import_paths.serverImportsFile,serverFileContent.join(\"\\n\"))},\"generateExtensionsImportFile\");const createExtensionImportEntry=__name(extension=>{const name=extension.name||extension.packageJson.name;const packagePath=extension.packageJson.name;const pkgExports=extension.packageJson.exports;const importEntry={name:extension.name||name,id:generateValidPackageName(name),label:extension?.navigation?.label||name,packagePath};if(pkgExports?.[\"./client\"])importEntry.clientPath=import_path.default.join(packagePath,\"client\");if(pkgExports?.[\"./server\"])importEntry.serverPath=import_path.default.join(packagePath,\"server\");return importEntry},\"createExtensionImportEntry\");const loadManifestExtensions=__name(()=>{try{const{extensions}=JSON.parse(import_fs.default.readFileSync(import_paths.manifestPath,\"utf-8\"));return extensions}catch(e){console.warn(\"Could not read extensions manifest\",e?.message);return[]}},\"loadManifestExtensions\");const installExtension=__name(extension=>{try{console.info(\"=== Installing \"+extension.source);(0,import_child_process.execSync)(`npm install ${extension.source} --prefix ${import_paths.extensionsTmpDir}`,{stdio:\"inherit\"});const packageInfo=JSON.parse((0,import_child_process.execSync)(`npm show ${extension.source} --json`).toString());import_fs.default.rmSync(import_path.default.join(import_paths.extensionsDir,packageInfo.name),{recursive:true,force:true});import_fs.default.cpSync(import_path.default.join(import_paths.extensionsTmpDir,\"node_modules\",packageInfo.name),import_path.default.join(import_paths.extensionsDir,packageInfo.name),{recursive:true});const installedExtension={...extension,packageJson:packageInfo};return createExtensionImportEntry(installedExtension)}catch(e){console.error(\"Could not install \"+extension.source,e?.message);return null}},\"installExtension\");function main(){const extensions=loadManifestExtensions();const extensionImportEntries=extensions.map(extension=>installExtension(extension)).filter(e=>e!==null);generateExtensionsImportFile(extensionImportEntries);import_fs.default.rmSync(import_paths.extensionsTmpDir,{recursive:true,force:true})}__name(main,\"main\");main();\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":["fs","path"],"ignoreList":[],"sources":["/workspace/aurora-dashboard/apps/aurora-portal/scripts/install-extensions.ts"],"sourcesContent":[null]}}